---
product: adobe campaign
solution: Journey Orchestration
title: 外部システムとの統合
description: 外部システムを統合する際のベストプラクティスを説明します
feature: ジャーニー
role: Business Practitioner
level: Beginner
exl-id: 27859689-dc61-4f7a-b942-431cdf244455
source-git-commit: 5346c3a25900b1e167ea5b199e1873adab39d07d
workflow-type: tm+mt
source-wordcount: '1011'
ht-degree: 1%

---

# 外部システムとの統合 {#external-systems}

このページでは、外部システムを統合する際にJourney Orchestrationが提供する様々なガードレールと、ベストプラクティスを示します。キャッピングAPIを使用して外部システムの保護を最適化する方法、ジャーニータイムアウトの設定方法、再試行の仕組み。

Journey Orchestrationを使用すると、カスタムデータソースおよびカスタムアクションを介した外部システムへの接続を設定できます。 これにより、例えば、外部の予約システムからのデータを使用してジャーニーをエンリッチメントしたり、EpsilonやFacebookなどのサードパーティシステムを使用してメッセージを送信したりできます。

外部システムを統合する際に、いくつかの問題が発生したり、システムが低速になったり、応答が停止したり、大量に処理できない場合があります。 Journey Orchestrationには、システムを過負荷から保護するためのガードレールがいくつか用意されています。

外部システムは、パフォーマンスの点で異なります。 使用例に合わせて設定を調整する必要があります。

Journey Orchestrationが外部APIの呼び出しを実行する場合、テクニカルガードレールは次のように実行されます。

1. キャッピングルールが適用されます。最大速度に達すると、残りのコールは破棄されます。

2. タイムアウトと再試行：上限ルールが満たされた場合、Journey Orchestrationは、タイムアウト時間の終わりに達するまで、呼び出しを実行しようとします。

## 制限{#capping}

組み込みのCapping APIは、外部システムの保護に役立つアップストリームの技術ガードレールを提供します。

外部データソースの場合、1秒あたりの最大呼び出し数は15に設定されます。 1秒あたりの呼び出し数が15を超えると、残りの呼び出しは破棄されます。 この制限は、プライベート外部データソースに対して増やすことができます。 Adobeに問い合わせて、エンドポイントをホワイトリストに登録します。 パブリック外部データソースに対しては、この操作はできません。

カスタムアクションの場合は、外部APIの処理能力を評価する必要があります。 例えば、Journey Optimizerが1秒あたり1000件の呼び出しを送信し、システムが1秒あたり100件の呼び出しのみをサポートする場合、システムが飽和しないように制限ルールを定義する必要があります。

キャッピングルールは、特定のエンドポイント（URLと呼ばれます）のサンドボックスレベルで定義されます。 実行時に、Journey Orchestrationは、制限ルールが定義されているかどうかを検証し、そのエンドポイントへの呼び出し中に、定義された率を適用します。 呼び出しの数が定義された率を超えると、残りの呼び出しは破棄され、レポートではエラーとしてカウントされます。

キャッピングルールは、1つのエンドポイントに固有ですが、サンドボックスのすべてのジャーニーに対してグローバルです。 つまり、キャッピングスロットは、サンドボックスのすべてのジャーニー間で共有されます。

例えば、外部システムに対して1秒あたり100呼び出しというキャッピングルールを定義したとします。 システムは、10種類のジャーニーのカスタムアクションによって呼び出されます。 1つのジャーニーが1秒に200通の呼び出しを受け取った場合、使用可能な100個のスロットを使用し、残りの100個のスロットを破棄します。 最大レートを超えたので、他の9つのジャーニーにはスロットは残りません。 この精度は、外部システムを過負荷やクラッシュから保護するのに役立ちます。

キャッピングAPIの詳細とキャッピングルールの設定方法については、[このページ](../api/capping.md)を参照してください。

## タイムアウトと再試行{#timeout}

上限ルールが満たされると、タイムアウトルールが適用されます。

各ジャーニーで、タイムアウト時間を定義できます。 これにより、外部システムの呼び出し時の最大時間を設定できます。 タイムアウト時間は、ジャーニーのプロパティで設定します。 [このページ](../building-journeys/changing-properties.md#timeout_and_error)を参照してください。

このタイムアウトは、すべての外部呼び出し（カスタムアクションおよびカスタムデータソースの外部API呼び出し）に対してグローバルに適用されます。 デフォルトでは、5秒に設定されています。

定義されたタイムアウト時間中に、Journey Orchestrationは外部システムの呼び出しを試みます。 最初の呼び出しの後、タイムアウト時間の終わりに達するまで、最大3回の再試行を実行できます。 再試行の回数は変更できません。

各再試行は1つのスロットを使用します。 1秒あたり100回の呼び出しの上限があり、各呼び出しに2回の再試行が必要な場合、速度は1秒あたり30回に低下します（各呼び出しで次の3つのスロットが使用されます）。最初の呼び出しと2回再試行)。

タイムアウト時間の値は、使用例によって異なります。 クライアントがストアに入ったときなど、メッセージをすばやく送信する場合は、長いタイムアウトを設定しないでください。 また、タイムアウトが長いほど、キューに入れられる項目が増えます。 これは、パフォーマンスに大きな影響を与えます。 Journey Orchestrationが1秒あたり1000回の呼び出しを実行する場合、5秒または15秒のデータを保持すると、システムをすぐに圧倒する可能性があります。

5秒のタイムアウトの例を見てみましょう。

* 最初の呼び出しが5秒未満続く：呼び出しが成功した場合、再試行は実行されません。
* 最初の呼び出しは5秒間存続します。呼び出しがキャンセルされ、再試行はありません。 レポートでは、タイムアウトエラーとしてカウントされます。
* 最初の呼び出しは2秒後に失敗します（外部システムがエラーを返します）。上限スロットが使用可能な場合、再試行の残り時間は3秒です。
   * 3回の再試行が5秒前に成功した場合は、呼び出しが実行され、エラーは発生しません。
   * 再試行中にタイムアウト時間の終わりに達した場合、呼び出しはキャンセルされ、レポートのタイムアウトエラーとしてカウントされます。

## よくある質問{#faq}

**キャッピングルールはどのようにして設定できますか？デフォルトのキャッピングルールはありますか？**

デフォルトでは、キャッピングルールはありません。 キャッピングルールは、キャッピングAPIを使用して、特定のエンドポイント（呼び出されたURL）のサンドボックスレベルで定義されます。 [この節](../about/external-systems.md#capping)と[このページ](../api/capping.md)を参照してください。

**実行される再試行の回数再試行回数を変更したり、再試行間の最小待ち時間を定義したりできますか？**

特定の呼び出しに対しては、最初の呼び出しの後、タイムアウト時間の終わりに達するまで、最大3回の再試行を実行できます。 再試行の回数と各再試行間の時間は変更できません。 [この節](../about/external-systems.md#timeout)を参照してください。

**タイムアウトはどこで設定できますか？最大値はありますか？**

各ジャーニーで、タイムアウト時間を定義できます。 タイムアウト時間は、ジャーニーのプロパティで設定します。 タイムアウト時間は、1秒から30秒の間である必要があります。 [この節](../about/external-systems.md#timeout)と[このページ](../building-journeys/changing-properties.md#timeout_and_error)を参照してください。